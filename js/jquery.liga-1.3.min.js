(function($,window,document,undefined){function bloqueador(){return $("<div />").addClass("bloquea").css({width:"105%",height:"105%",margin:"-10px",position:"fixed","z-index":10,opacity:"0.6",filter:"alpha(opacity = 60)"})}function centrar(e){var t=$(window).width()/2;var n=$(window).height()/2;var r=e.outerWidth()/2;var i=e.outerHeight()/2;if(r*2>t*2*.5){e.animate({position:"fixed",left:5,top:5,right:5})}else{e.css({position:"fixed",left:t-r,top:(n-i)*.4})}}function validar(input,regla,forma){var valido=true;var valor=input.val();if(window.FormData){if(input.attr("type")=="file"){var campo=input.get(0);var files=campo.files;for(var i=0;i<files.length;i++){if(files[i].name&&files[i].size){if(regla["tamin"]&&files[i].size<regla["tamin"]||regla["tamax"]&&files[i].size>regla["tamax"]){return false}var ext=files[i].name.substring(files[i].name.lastIndexOf(".")+1);if(regla["patron"]){var pat=regla["patron"]["length"]?regla["patron"]:[regla["patron"]];var val=false;for(var j in pat){if(pat[j].test(ext)||files[i].type&&pat[j].test(files[i].type)){val=true}}if(!val){return false}}}}return true}}if(regla["patron"]){var pat=regla["patron"]["length"]?regla["patron"]:[regla["patron"]];var val=false;for(var i in pat){if(pat[i].test(valor)){val=true}}if(!val){valido=false}}if(regla["mayor"]){if(isNaN(valor)||valor<=regla["mayor"]){valido=false}}if(regla["menor"]){if(isNaN(valor)||valor>=regla["menor"]){valido=false}}if(regla["cond"]){var campos=forma.serializeArray();var form={};for(var i in campos){form[campos[i]["name"]]=campos[i]["value"]}try{valido=eval("("+regla["cond"]+")")}catch(e){$.error('Error al evaluar la condición "'+regla["cond"]+'"');valido=false}}return valido}function obj2Hash(e){var t=e?e:parent.location.hash;t=t.indexOf("#")==0?t.substring(1):t;t=t.split("//");var n={};for(var r in t){var i=t[r].split("/");if(i[0]&&i[1]){var s=i[0];var o=i[1];for(var u=2;u<i.length;u++){o+="/"+i[u]}n[s]=o}}return n}function procesarHash(){var e=obj2Hash();var t=$("body").data("historialLIGA");for(var n in t){if(e[n]){var r=$("#"+n).data("historialLIGA");if(r["actual"]!=e[n]){cargar(n,r["url"],e[n],r["func"]);r["actual"]=e[n];$("#"+n).data("historialLIGA",r)}}else{var i=$("#"+n).data("historialLIGA");if(i["actual"]!=i["param"]){cargar(n,i["url"],i["param"],i["func"]);i["actual"]=i["param"];$("#"+n).data("historialLIGA",i)}}}}function cargar(e,t,n,r){var i=$("#"+e);var s=i.data("historialLIGA");var o=i.data(n);if(s["cache"]&&o){i.html(o);if(r){r(resp)}}else{i.liga("mensaje",{msj:'<span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span> Cargando',seg:0,btn:false});if(n.indexOf(":")===0){t=encodeURI(n.substring(1));n=""}i.load(t,encodeURI(n),function(e){if(s["cache"]){i.data(n?n:decodeURI(":"+t),e)}if(r){r(e)}})}}function Plugin(e,t,n){this.method=e;this.element=t;this.options=n;this._name=pluginName;if(this[e]){return this[e](this.element,this.options)}}var pluginName="liga";Plugin.prototype={alerta:function(e,t){if(typeof t!=="object")t={msj:String(t)};var n=$.extend({msj:" ",tit:"¡Atención!","class":"alerta",vel:"fast",btn:"Cerrar",fijo:true,func:function(){}},t);var r=bloqueador();$("body").prepend(r);var i=$("<div />").addClass("titAlerta ui-widget-header").html('<span class="ui-icon ui-icon-notice" style="float: left; margin-right: .3em;"></span>'+n["tit"]);var s=$("<button />").addClass("cerrarMsjAlerta btn1").html(n["btn"]).click(function(e){$(this).parent().slideUp(n["vel"],function(){n["func"]();r.remove();$(this).remove()});e.preventDefault()});var o=$("<div />").addClass("contAlerta").html(n["msj"]);var u=$("<div />").addClass(n["class"]+" ui-widget-content").prepend(i,o,s);$("body").prepend(u);centrar(u);u.slideDown(n["vel"],function(){s.focus();centrar(u);$(window).resize(function(){centrar(u)});if($.isFunction($.fn.draggable)){u.draggable({handle:".titAlerta",scroll:false,revert:n["fijo"]});$(".titAlerta",u).css({cursor:"move"}).disableSelection()}});return u},pregunta:function(e,t){if(typeof t!=="object")t={msj:String(t)};var n=$.extend({msj:" ",tit:"Confirmación","class":"alerta",vel:"fast",btnS:"Sí",btnN:"No",fijo:true,funcS:function(){},funcN:function(){}},t);var r=bloqueador();$("body").prepend(r);var i=$("<div />").addClass("titAlerta ui-widget-header").html('<span class="ui-icon ui-icon-help" style="float: left; margin-right: .3em;"></span>'+n["tit"]);var s=$("<button />").addClass("cerrarMsjAlerta btn1").html(n["btnS"]).click(function(e){n["funcS"]();$(this).parent().slideUp(n["vel"],function(){r.remove();$(this).remove()});e.preventDefault()});var o=$("<button />").addClass("cerrarMsjAlerta btn2").html(n["btnN"]).click(function(e){n["funcN"]();$(this).parent().slideUp(n["vel"],function(){r.remove();$(this).remove()});e.preventDefault()});var u=$("<div />").addClass("contAlerta").html(n["msj"]);var a=$("<div />").addClass(n["class"]+" ui-widget-content").prepend(i,u,s,o);$("body").prepend(a);centrar(a);a.slideDown(n["vel"],function(){o.focus();$(window).resize(function(){centrar(a)});if($.isFunction($.fn.draggable)){a.draggable({handle:".titAlerta",scroll:false,revert:n["fijo"]});$(".titAlerta",a).css({cursor:"move"}).disableSelection()}});return a},memoria:function(e,t){var n=typeof t=="string"?t:t[0];var r=typeof t=="object"&&t[1]||t[1]==null?t[1]:undefined;var i=typeof t=="object"&&t[2]?t[2]:undefined;if(typeof n==="string"&&n!==""){if(window.localStorage&&i===undefined){if(r===null){window.localStorage.removeItem(n);return true}if(r===undefined)return window.localStorage.getItem(n);if(r!==null&&r!==undefined)window.localStorage.setItem(n,r)}else{if(r){var s=new Date;i=!isNaN(i)?i:365;s.setTime(s.getTime()+i*24*60*60*1e3);i="; expires="+s.toGMTString();document.cookie=n+"="+r+i+"; path=/"}else{if(r===null){return $.liga("guardar",n," ",-1)}n=n+"=";var o=document.cookie.split(";");for(var u=0;u<o.length;u++){var a=o[u];while(a.charAt(0)==" ")a=a.substring(1,a.length);if(a.indexOf(n)==0)return a.substring(n.length,a.length)}return null}}return r}return false},notificacion:function(e,t){if(typeof t!=="object")t={msj:String(t)};var n=$.extend({msj:" ",tit:"Notificación",img:"http://4.bp.blogspot.com/-6hx-qdNb8XU/T4nW4Q-Qf4I/AAAAAAAAAWs/IY0z6IPpbyQ/s200/LIGA.PNG",seg:10,alt:"body",func:function(){},funClic:function(){}},t);if(!window.webkitNotifications){n["msj"]='<img src="'+n["img"]+'" width="35" height="35" style="float: left;" /> '+n["msj"];return $(n["alt"]).liga("mensaje",n)}var r=window.webkitNotifications.checkPermission();if(r==2){n["msj"]='<img src="'+n["img"]+'" width="35" height="35" style="float: left;" /> '+n["msj"];return $(n["alt"]).liga("mensaje",n)}if(r>0){window.webkitNotifications.requestPermission(function(){return $.liga("notificacion",n)})}else{var i=window.webkitNotifications.createNotification(n["img"],n["tit"],n["msj"]);i.onclose=n["func"];i.onclick=n["funClic"];i.show();if(n["seg"]){setTimeout(function(){i.cancel()},n["seg"]*1e3)}}return i},mensaje:function(e,t){if(typeof t!=="object")t={msj:String(t)};var n=$.extend({msj:" ",tit:"Mensaje","class":"msj1 ui-state-highlight",vel:"fast",seg:10,btn:" X ",conservar:true,func:function(){}},t);var r="";if(n["btn"]){r=$("<button />").addClass("cerrarMsj").html(n["btn"]).click(function(e){$(this).parent().slideUp(n["vel"],function(){n["func"]();$(this).remove()});e.preventDefault()}).attr("title","Cerrar mensaje")}var i=$("<div />").addClass(n["class"]+" ui-widget-content").attr("title",n["tit"]).css({display:"none"}).append(r,n["msj"]);var s=$(e);if(s.context.tagName==="BODY"){var o=$("#LIGADIVFLOTANTE");if(o.length==0){o=$("<div />").attr("id","LIGADIVFLOTANTE").css({width:"400px",position:"fixed",left:"50%"});$("body").prepend(o.css({position:"fixed","margin-left":"-200px"}))}o.prepend(i)}else{s.prepend(i)}i.fadeIn(n["vel"],function(){if(n["btn"]){r.focus()}if(n["seg"]){var e=$(this);var t=setTimeout(function(){e.fadeOut(n["vel"],function(){n["func"]();$(this).remove()})},n["seg"]*1e3);if(n["conservar"]){e.mousemove(function(){clearTimeout(t)})}}})},AJAX:function(e,t){var n=$.extend({url:"",reg:{},fil:{},seg:10,func:function(e){n["mensajes"](e)},error:function(e,t,r,i){$(".error",t.parent()).remove();if(!i){var s=$("<span />").addClass("error ui-widget-content ui-state-error").css({display:"none"}).html('<span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>'+e);t.parent().append(s.fadeIn("medium"));t.one("change",function(){var i=t.attr("name");if(n["reg"][i]["requerido"]||t.val()!==""||n["reg"][i]["numin"]){if(validar(t,n["reg"][i],r)===true){n["error"](e,t,r,true)}else{n["error"](e,t,r,false)}}else{n["error"](e,t,r,true)}})}},reset:function(e,t){$(".error",e).fadeOut("fast",function(){$(this).remove()})},mensajes:function(e){$("body").liga("mensaje",e)}},t);var r=$(e);var i=e;n["url"]=r.attr("action")?r.attr("action"):n["url"];r.on("submit",function(e){r.bind("reset",function(e){n["reset"](r,e)});var t=r.serializeArray();var s=true;var o={};for(var u in t){var a=t[u]["name"];var f=t[u]["value"];var l=$("[name="+a+"]",r);l.unbind("change");if(n["reg"][a]){var c=n["reg"][a];var h=c["msj"]?c["msj"]:"El campo "+a+" no es válido";if(c["requerido"]){if(f!==""){if(!validar(l,c,r)){n["error"](h,l,r);s=false}}else{n["error"](h,l,r);s=false}}else{if(f!==""){if(!validar(l,c,r)){n["error"](h,l,r);s=false}}}}if(n["fil"][a]){o[a]=f;i[a].value=n["fil"][a](f)}}var p=false;var t=$(":file",r);var d=true;if(window.FormData){t.each(function(){var e=this;$(e).unbind("change");if(n["reg"][e.name]){var t=n["reg"][e.name];var i=t["msj"]?t["msj"]:"Archivo(s) inválido(s) en el campo "+e.name;var o=this.files;if(o.length>0){p=true;if(!validar($(e),t,r)){n["error"](i,$(e),r);s=false}}else{if(t["numin"]&&o.length<t["numin"]){n["error"](i,$(e),r);s=false}}}})}else if(t.size()>0){d=false}if(s){$(".error",r).remove();var v=r.serialize();if(!r.data(v)){n["mensajes"]({msj:'<span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span> Enviando información al servidor',seg:2,conservar:false});r.data(v,true);if(d){var m=r.attr("method")?r.attr("method"):"GET";var g;var y={url:n["url"],timeout:n["seg"]*1e3,type:m};if(p&&window.FormData){g=new FormData(i);n["mensajes"]({msj:'<span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span> Subiendo <progress id="LIGAprogress"><em id="progreso"></em></progress>',seg:5,conservar:true});y["contentType"]=false;y["processData"]=false;y["cache"]=false;y["xhr"]=function(){var e=$.ajaxSettings.xhr();if(e.upload){var t=$("progress#LIGAprogress");var n=$("#progreso");e.upload.addEventListener("progress",function(e){if(e.lengthComputable){t.attr({value:e.loaded,max:e.total});n.text(e.loaded+" de "+e.total);if(e.loaded>=e.total){t.parent().fadeOut(function(){$(this).remove()})}}},false)}return e}}else{g=$(i).serialize()}y["data"]=g;$.ajax(y).always(function(e){r.removeData(v)}).done(function(e){n["func"](e)}).fail(function(e,t,r){var i={"Not Found":"Recurso no encontrado en el servidor",timeout:"Se superó el tiempo de espera"};var s=i[r]?i[r]:"Error en el servidor";n["func"]({msj:'<span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>'+s+", inténtelo de nuevo más tarde",seg:0,tit:t,"class":"msj2 ui-state-error"})})}else{var b=$("<iframe />").css({width:0,height:0,display:"none"}).attr("name","LIGAreceptor");$("body").append(b);r.attr("target","LIGAreceptor").attr("enctype","multipart/form-data");r.unbind("submit");r.submit();b.load(function(){var e=b.contents();n["func"]($("body",e).html());r.removeData(v);r.liga("AJAX",n)})}}else{n["mensajes"]({msj:'<span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span> Procesando la información, espere por favor',seg:2,conservar:false,"class":"msj2 ui-state-error"})}}for(var a in n["fil"]){i[a].value=o[a]}e.preventDefault()})},historial:function(e,t){if(typeof t!=="object")return this;var n={};for(var r in t){t[r]["actual"]="";$("#"+r).data("historialLIGA",t[r]);n[r]=true}$("body").data("historialLIGA",n);procesarHash();window.onhashchange=procesarHash;return this},cargar:function(e,t){if(typeof t!=="string")return this;var n=obj2Hash();var r=obj2Hash(t);var i="";for(var s in n){if(!r[s]||r[s]==n[s]){i+=i==""?s+"/"+n[s]:"//"+s+"/"+n[s]}}for(var s in r){if(r[s]!=n[s]){i+=i==""?s+"/"+r[s]:"//"+s+"/"+r[s]}}parent.location.href="#"+i;return this},actualizar:function(e,t){if(typeof t!=="string")return this;var n=t.indexOf("/")>-1?t.substring(0,t.indexOf("/")):t;var r=t.indexOf("/")>-1?t.substring(t.indexOf("/")+1):false;var i=$("#"+n);var s=i.data("historialLIGA");if(s){if(r){i.removeData(r)}else{i.removeData();i.data("historialLIGA",s)}}return this}};$[pluginName]=function(e,t){var n=document.body;if(!$.data(n,pluginName)){$.data(n,pluginName,new Plugin(undefined,$,t))}return $.data(n,pluginName)[e]($,t)};$.fn[pluginName]=function(e,t){return this.each(function(){if(!$.data(this,pluginName)){$.data(this,pluginName,new Plugin(e,this,t))}else{$.data(this,pluginName)[e](this,t)}})}})(jQuery,window,document);